<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">

<title>Piotrflix Log Viewer</title>

<!-- ‚ùó BLOKADA ZOOMU + PE≈ÅNY EKRAN -->
<meta name="viewport"
      content="width=device-width, initial-scale=1.0,
               maximum-scale=1.0, user-scalable=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e1e1e">

<style>
/* =========================================
   GLOBAL FULLSCREEN APP
   ========================================= */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #1e1e1e;
    font-family: Arial, sans-serif;
    color: #d4d4d4;
    overflow: hidden;
}

.app {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* =========================================
   LOGIN PANEL
   ========================================= */
#loginView {
    width: 95%;
    max-width: 480px;
    background: #252525;
    padding: 35px;
    border-radius: 16px;
    box-shadow: 0 0 25px rgba(0,0,0,0.55);

    display: flex;
    flex-direction: column;
    align-items: center;
}

/* üëâ NARZUCONA WƒÑSKA KOLUMNA 320px */
.login-inner {
    width: 100%;
    max-width: 320px;
}

.logo {
    width: 180px;
    display: block;
    margin: 0 auto 25px;
}

label {
    display: block;
    margin-top: 10px;
    font-size: 15px;
}

input {
    width: 100%;
    padding: 12px;
    background: #111;
    border-radius: 8px;
    border: 1px solid #333;
    margin-top: 6px;
    font-size: 15px;
    color: white;
    box-sizing: border-box;
}

button {
    width: 100%;
    padding: 14px;
    margin-top: 20px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    background: #ff3d00;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #ff5722;
}

#error {
    margin-top: 10px;
    color: #ff4444;
    text-align: center;
    font-weight: bold;
}

/* =========================================
   LOGS VIEW - Wƒò≈ªSZY BOX!
   ========================================= */
#logsView {
    display: none;
    width: 95%;
    max-width: 850px;
    height: 95%;
    background: #252525;
    border-radius: 16px;
    padding: 35px;
    box-shadow: 0 0 25px rgba(0,0,0,0.55);

    display: flex;
    flex-direction: column;
    align-items: center;
}

/* üëâ WƒÑSKA KOLUMNA DLA LOG√ìW 600px */
.logs-inner {
    width: 100%;
    max-width: 600px;
}

.header-logo {
    width: 180px;
    display: block;
    margin-bottom: 10px;
}

h2 {
    margin: 5px 0 15px 0;
    color: #ff3d00;
    font-size: 22px;
    text-align: center;
}

#pauseBtn {
    width: 100%;
    max-width: 300px;
}

#logBox {
    width: 100%;
    height: 100%;
    min-height: 60vh;

    background: #111;
    border-radius: 12px;
    border: 1px solid #333;

    padding: 15px;
    margin-top: 15px;
    box-sizing: border-box;

    overflow-y: auto;
    white-space: pre-wrap;

    font-family: Consolas, monospace;
    font-size: 14px;
}
</style>
</head>


<body>

<div class="app">

    <!-- ================= LOGIN VIEW ================= -->
    <div id="loginView">
        <img src="logos/logo.png" class="logo">

        <div class="login-inner">
            <label>Login:</label>
            <input type="text" id="login">

            <label>Has≈Ço:</label>
            <input type="password" id="password">

            <div id="error"></div>

            <button onclick="tryLogin()">Zaloguj</button>
        </div>
    </div>

    <!-- ================= LOGS VIEW ================= -->
    <div id="logsView">
        <img src="logos/logo.png" class="header-logo">

        <div class="logs-inner">
            <h2>API LOGS</h2>

            <button id="pauseBtn" onclick="togglePause()">‚è∏ Pauza</button>

            <div id="logBox"></div>
        </div>
    </div>

</div>

<script>
/* BACKEND URL */
const SERVER_URL = "https://api.pkportfolio.pl";

let loginUser = "";
let loginPass = "";
let paused = false;

/* AUTH HEADER */
function authHeader(u, p) {
    return "Basic " + btoa(u + ":" + p);
}

/* FETCH LOGS */
async function fetchLogs() {
    try {
        const r = await fetch(`${SERVER_URL}/logs/tail`, {
            headers: { "Authorization": authHeader(loginUser, loginPass) }
        });

        if (r.status === 401)
            return { error: true, msg: "‚ùå B≈Çƒôdny login lub has≈Ço (401)" };

        return { error: false, log: (await r.json()).log };

    } catch (e) {
        return { error: true, msg: "‚ö†Ô∏è B≈ÇƒÖd po≈ÇƒÖczenia: " + e };
    }
}

/* LOGIN */
async function tryLogin() {
    const user = login.value.trim();
    const pass = password.value.trim();
    const err = document.getElementById("error");

    if (!user || !pass) {
        err.innerText = "‚ö†Ô∏è Wype≈Çnij login i has≈Ço!";
        return;
    }

    loginUser = user;
    loginPass = pass;

    const test = await fetchLogs();
    if (test.error) {
        err.innerText = test.msg;
        return;
    }

    loginView.style.display = "none";
    logsView.style.display = "flex";
}

/* UPDATE LOGS */
async function updateLogs() {
    if (paused) return;

    const box = document.getElementById("logBox");
    const res = await fetchLogs();

    if (res.error) {
        box.textContent = res.msg;
        return;
    }

    box.textContent = res.log;
    box.scrollTop = box.scrollHeight;
}
setInterval(updateLogs, 2000);

/* PAUSE */
function togglePause() {
    paused = !paused;
    pauseBtn.innerText = paused ? "‚ñ∂ Wzn√≥w" : "‚è∏ Pauza";
    if (!paused) updateLogs();
}

/* REGISTER SERVICE WORKER */
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
